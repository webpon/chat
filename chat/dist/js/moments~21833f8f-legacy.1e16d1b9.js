(window.webpackJsonp=window.webpackJsonp||[]).push([["moments~21833f8f"],{"57b7":function(t,e,s){},"6ac9":function(t,e,s){"use strict";s("ccd7")},"70ef":function(t,e,s){"use strict";s("57b7")},"94a8":function(t,e,s){},a1e9:function(t,e,s){},b1bc:function(t,e,s){"use strict";s.r(e);var i={computed:{},methods:{toMoments(){this.$router.push({path:"/discover/moments"})},toEmail(){this.$router.push({path:"/discover/fastEmail"})}}},s=(s("baaf"),s("0c7c")),s=Object(s.a)(i,function(){var t=this,e=t._self._c;return e("div",{staticClass:"background"},[e("div",{staticClass:"top_title"},[t._v("发现")]),e("div",{staticClass:"series"},[e("div",{staticClass:"bar friend",on:{click:t.toMoments}},[t._v(" 朋友圈 "),e("a-icon",{attrs:{type:"right"}})],1),e("div",{staticClass:"bar friend",on:{click:t.toEmail}},[t._v(" 快捷邮件 "),e("a-icon",{attrs:{type:"right"}})],1),e("div",{staticClass:"bar friend"},[t._v(" 摇一摇 "),e("a-icon",{attrs:{type:"right"}})],1),e("div",{staticClass:"line"}),e("div",{staticClass:"bar friend"},[t._v(" 附近的人 "),e("a-icon",{attrs:{type:"right"}})],1)])])},[],!1,null,"827f2134",null);e.default=s.exports},baaf:function(t,e,s){"use strict";s("94a8")},c948:function(t,e,s){"use strict";s("a1e9")},ccd7:function(t,e,s){},d24c:function(t,e,s){"use strict";s.r(e);var i=s("3089"),o={name:"comment",components:{rightClick:s("4146").a},props:{comment:{type:Object},replyId:{type:String}},data(){return{user:{username:null,imgSrc:null},replyUser:{username:null,imgSrc:null},delAxis:{x:100,y:100},showDel:!1}},created(){var t=this.comment.userId;this.$http.get("/user",{params:{id:t}}).then(({data:{userInfo:t}})=>{this.user=t}),void 0!==this.replyId&&(t=this.replyId,this.$http.get("/user",{params:{id:t}}).then(({data:{userInfo:t}})=>{this.replyUser=t}))},methods:{reply(){this.$emit("send",0===this.comment.replyId?this.comment.id:this.comment.replyId,this.user.username)},delComment(){i.Dialog.confirm({title:"提示",message:"删除该评论？"}).then(()=>{this.$moments.delete("/comment",{data:{id:this.comment.id}}).then(({data:{code:t,data:e}})=>{200===t&&this.$emit("del",e.id)})})},del({x:t,y:e}){this.$store.commit("showRightClick",{b:!0,axis:{x:t,y:e}}),this.$store.commit("addRightClickEvent",[{text:"复制",event:this.copy,show:!0},{text:"删除",event:this.delComment,show:this.comment.my||this.comment.admin}]);const s=t=>{this.$store.commit("showRightClick",!1),document.removeEventListener("click",s)};document.addEventListener("click",s)},handlerTouchstart(){return this.loop=setTimeout(()=>{this.loop=0,this.showDel=!1},500),!1},handlerTouchmove(){clearTimeout(this.loop),this.loop=0},handlerTouchend(){clearTimeout(this.loop),0!==this.loop&&(this.clickShow=!0,this.longClickShow=!1)},copy(){var t=document.createElement("textarea"),e=(t.setAttribute("readonly","readonly"),t.value=this.comment.content,document.body.appendChild(t),t.select(),document.execCommand("copy"));return document.body.removeChild(t),e}}},n=(s("c948"),s("0c7c")),o={name:"moments",data:function(){return{showOparate:!1,showComment:!1,commentObj:{content:null,momentsId:null},col:this.collect,user:{username:null,imgSrc:null},prompt:"评论",likeNameList:[],show:!1,contentLink:""}},components:{comment:Object(n.a)(o,function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"comment flex default",on:{click:e.reply,contextmenu:function(t){return t.preventDefault(),t.stopPropagation(),e.del.apply(null,arguments)},touchstart:e.handlerTouchstart,touchmove:e.handlerTouchmove,touchend:e.handlerTouchend}},[t("p",[t("span",{staticClass:"nick"},[e._v(e._s(e.user.username))]),0!==e.comment.replyId?t("span",[e._v(" 回复 "),t("span",{staticClass:"nick"},[e._v(e._s(e.replyUser.username))])]):e._e(),e._v(" ： ")]),t("p",{staticClass:"comment_content"},[e._v(e._s(e.comment.content))])])])},[],!1,null,"0d998fc4",null).exports},props:{collect:{type:Object}},created(){var t=this.col.moments.userId;this.$http.get("/user",{params:{id:t}}).then(({data:{userInfo:t}})=>{this.user=t}),this.col.likes.map(t=>{let e=t.userId;this.$http.get("/user",{params:{id:e}}).then(({data:{userInfo:t}})=>{this.likeNameList.push({...t,id:e})})})},methods:{getUrl(t){t=t.match(/(https?|http|ftp|file):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/g);return t&&0<t.length?t[0]:null},delComment(e){this.col.comments=this.col.comments.filter(t=>t.id!==e)},toChat(t){var e;t===this.$store.state.myInfo.username?this.alertWheel.div.add(this.alertWheel.button).add(this.alertWheel.p).show():(e={...this.user,msg:null,msgNumber:0},this.$store.commit("updateChatList",e),this.$router.push({path:"/chat/toChat",query:{userName:t}}))},previewImg(t){Object(i.ImagePreview)({images:this.col.moments.images.map(t=>t.url),startPosition:t})},onPlayerPlay(){var t=this.$store.state.playingVideo;t&&t!==this.$refs.videoPlayer.player&&t.pause(),this.$store.commit("updatePlayingVideo",this.$refs.videoPlayer.player)},sendMsg(){this.commentObj.momentsId=this.col.moments.id,this.$moments.post("/comment",this.commentObj).then(({data:{msg:t,code:e,data:s}})=>{if(200!==e)this.$message.warn(t);else if(0===s.replyId)this.col.comments.push(s);else{var i=this.col.comments;for(let t=0;t<i.length;t++){var o=i[t];if(o.id===s.replyId){o.children.push(s);break}}this.col.comments=i}}),this.commentObj={content:"",momentsId:null,replyId:null},this.showComment=!1},update(t,e){this.commentObj.replyId=t,this.showComment=!0,this.prompt="回复 "+e},like(){this.$moments.post("/like",{momentsId:this.col.moments.id}).then(({data:{code:t,data:s,msg:e}})=>{if(200===t)if("点赞成功"===e){this.col.likes.push(s),this.col.isMyLike=!0;let e=s.userId;this.$http.get("/user",{params:{id:e}}).then(({data:{userInfo:t}})=>{this.likeNameList.push({...t,id:e})})}else{let e=[];this.col.likes.forEach(t=>{t.id!==s.id&&e.push(t)}),this.likeNameList=this.likeNameList.filter(t=>t.id!==s.userId),this.col.likes=e,this.col.isMyLike=!1}}),this.showOparate=!1},deleteMoments(){i.Dialog.confirm({title:"提示",message:"删除该朋友圈？"}).then(()=>{this.$moments.delete("/moments/"+this.col.moments.id).then(({data:{code:t}})=>{200===t&&this.$emit("delete",this.col.moments.id)})}).catch(()=>{})}},watch:{showComment(){setTimeout(()=>{this.$refs.input.focus()},100)}}};s("6ac9");o={name:"momentsView",components:{moments:Object(n.a)(o,function(){var s=this,i=s._self._c;return i("div",{staticClass:"msg_container"},[i("div",{staticClass:"moment_msg flex"},[i("img",{staticClass:"_avater pointer _img-scale",attrs:{src:s.user.imgSrc},on:{click:function(t){return s.toChat(s.user.username)}}}),i("div",{staticClass:"msg"},[i("span",{staticClass:"nick pointer",on:{click:function(t){return s.toChat(s.user.username)}}},[s._v(s._s(s.user.username))]),(s.contentLink=s.getUrl(s.col.moments.content))?i("p",[i("a",{staticStyle:{"text-decoration":"underline"},attrs:{href:s.contentLink}},[s._v(s._s(s.col.moments.content))])]):i("p",{staticClass:"msg_content"},[s._v(s._s(s.col.moments.content))]),1===s.col.moments.images.length?i("div",[1===s.col.moments.images[0].type?i("img",{directives:[{name:"lazy",rawName:"v-lazy",value:s.col.moments.images[0].url,expression:"col.moments.images[0].url"}],staticClass:"msg_img _img-scale",on:{click:function(t){return s.previewImg(0)}}}):i("video-player",{ref:"videoPlayer",staticStyle:{width:"100%",height:"100%"},attrs:{options:{height:200,sources:[{src:s.col.moments.images[0].url}]}},on:{play:s.onPlayerPlay}})],1):i("div",[s._l(s.col.moments.images,function(t,e){return[1===t.type?i("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t.url,expression:"image.url"}],staticClass:"msg_img _img-scale",staticStyle:{width:"80px",height:"80px"},attrs:{alt:""},on:{click:function(t){return s.previewImg(e)}}}):s._e()]})],2),i("div",{staticClass:"flex oparate"},[i("div",[i("p",[s._v(s._s(s.col.moments.timeDesc))]),s.col.moments.my||s.col.moments.admin?i("span",{staticClass:"pointer",on:{click:s.deleteMoments}},[s._v("删除")]):s._e()]),i("div",[i("div",{directives:[{name:"show",rawName:"v-show",value:s.showOparate,expression:"showOparate"}]},[s.collect.isMyLike?i("button",{staticClass:"pointer",on:{click:s.like}},[i("van-icon",{attrs:{name:"like",color:"red"}}),s._v(" 取消 ")],1):i("button",{staticClass:"pointer",on:{click:s.like}},[i("van-icon",{attrs:{name:"like-o"}}),s._v(" 点赞 ")],1),i("button",{on:{click:()=>{this.showComment=!0,this.showOparate=!1,this.prompt="评论"}}},[i("van-icon",{attrs:{name:"comment"}}),s._v(" 评论 ")],1)]),i("p",{staticClass:"bar pointer",on:{click:function(t){s.showOparate=!s.showOparate}}},[s._v("··")])])]),i("div",{staticClass:"comment_container"},[1<=s.likeNameList.length?i("div",[i("van-icon",{staticStyle:{"padding-right":"3px"},attrs:{name:"like",color:"red"}}),s._l(s.likeNameList,function({username:t},e){return i("span",{key:e},[i("span",{staticClass:"nick pointer",on:{click:()=>s.toChat(t)}},[s._v(s._s(t))]),e!==s.likeNameList.length-1?i("span",[s._v(", ")]):s._e()])})],2):s._e(),s._l(s.col.comments,function(e){return i("div",{key:e.id},[i("comment",{attrs:{comment:e},on:{send:s.update,del:s.delComment}}),s._l(e.children,function(t){return 0<e.children.length?i("comment",{key:t.id,attrs:{comment:t,"reply-id":e.userId},on:{del:s.delComment}}):s._e()})],2)}),i("div",{directives:[{name:"show",rawName:"v-show",value:s.showComment,expression:"showComment"}],staticClass:"comment"},[i("a-input",{ref:"input",staticStyle:{height:"30px"},attrs:{maxLength:200,placeholder:s.prompt},on:{pressEnter:function(t){return t.preventDefault(),s.sendMsg.apply(null,arguments)}},model:{value:s.commentObj.content,callback:function(t){s.$set(s.commentObj,"content","string"==typeof t?t.trim():t)},expression:"commentObj.content"}}),i("a-button",{staticStyle:{height:"28px"},on:{click:s.sendMsg}},[s._v("发送")])],1)],2)])])])},[],!1,null,"1644e58f",null).exports},data(){return{momentsList:[],page:1,toGet:!0,loadTimer:null,isLoading:!1,showTop:!1,timeFlag:!0,loadingMoments:!1}},mounted(){this.$refs.container.$el.style.height=window.innerHeight+"px",this.$refs.container.$el.addEventListener("scroll",this.checkIsBottom)},methods:{onRefresh(){this.$moments.get("/moments/1").then(({data:{code:t,data:e}})=>{if(200===t){var s=[];t:for(let t=0;t<e.length-1;t++){var i=e[t].moments.id;for(let t=0;t<this.momentsList.length;t++){const e=this.momentsList[t].moments.id;if(e===i)continue t}s.push(e[t])}this.momentsList.unshift(...s)}this.isLoading=!1})},getMoments({refresh:s=!1}={}){s&&(this.page=1,this.toGet=!0),this.$moments.get("/moments/"+this.page).then(({data:{code:t,data:e}})=>{200===t?s?this.momentsList=e:this.momentsList.push(...e):this.toGet=!1,this.loadingMoments=!1})},deleteMoments(e){this.momentsList=this.momentsList.filter(t=>t.moments.id!==e)},toEditMoment(){this.$router.push({path:"/discover/editMoment"})},checkIsBottom(){const t=this.$refs.container.$el;this.timeFlag&&(this.timeFlag=!1,setTimeout(()=>{200<=t.scrollTop?this.showTop=!0:this.showTop=!1,this.timeFlag=!0},300)),this.toGet&&(clearTimeout(this.loadTimer),this.loadTimer=setTimeout(()=>{t.clientHeight+t.scrollTop>t.scrollHeight-60&&(this.loadingMoments=!0,this.page++,this.getMoments())},100))}},activated(){this.showTop=!1,this.getMoments({refresh:!0})}},s("70ef"),s=Object(n.a)(o,function(){var e=this,s=e._self._c;return s("van-pull-refresh",{ref:"container",staticClass:"container",on:{refresh:e.onRefresh},model:{value:e.isLoading,callback:function(t){e.isLoading=t},expression:"isLoading"}},[s("div",{staticClass:"background"},[e.showTop?s("div",{staticClass:"top-wrapper flex"},[s("a-icon",{staticClass:"_back back",attrs:{type:"left"},on:{click:function(t){return e.$router.replace("/discover")}}}),s("p",{staticStyle:{color:"#fff","font-weight":"bold","font-size":"15px"}},[e._v("朋友圈")]),s("a-icon",{staticClass:"post_moment",attrs:{type:"camera",theme:"filled"},on:{click:e.toEditMoment}})],1):[s("a-icon",{staticClass:"_back back",attrs:{type:"left"},on:{click:function(t){return e.$router.replace("/discover")}}}),s("a-icon",{staticClass:"post_moment",attrs:{type:"camera",theme:"filled"},on:{click:e.toEditMoment}})],s("img",{staticClass:"moment_back",attrs:{src:"https://picx.zhimg.com/80/v2-35857f0199cc225e186098e765dd173c_720w.webp?source=1940ef5c"}}),s("img",{staticClass:"b_avater avater _img-scale",attrs:{src:e.$store.state.myInfo.imgSrc}})],2),s("div",{ref:"momentContainer",staticClass:"momentContainer"},e._l(e.momentsList,function(t){return s("div",{key:t.moments.id},[s("moments",{attrs:{collect:t},on:{delete:e.deleteMoments}}),s("div",{staticClass:"line"})],1)}),0),s("div",{staticClass:"flex center",staticStyle:{padding:"10px 0 3px 0"}},[s("span",{directives:[{name:"show",rawName:"v-show",value:e.loadingMoments,expression:"loadingMoments"}]},[s("a-icon",{staticStyle:{"padding-right":"10px"},attrs:{type:"loading"}}),e._v("正在加载... ")],1)]),e.toGet?e._e():s("div",{staticClass:"no-more"},[e._v("没有更多了 ~")])])},[],!1,null,"592423fa",null);e.default=s.exports}}]);